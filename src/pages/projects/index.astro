---
import Layout from "../../layouts/Layout.astro";
import ContentCard from "../../components/ContentCard.astro";
import { getProjects } from "../../lib/content";

const allProjects = await getProjects();

type PStatus = "featured" | "completed" | "in-progress" | "archived";
const buckets: Record<PStatus, typeof allProjects> = {
  featured: [],
  completed: [],
  "in-progress": [],
  archived: [],
};

for (const p of allProjects) {
  const s = (p.data.projectStatus ?? "in-progress") as PStatus;
  (buckets[s] ?? buckets["in-progress"]).push(p);
}

const categories = [
  "Signals & Systems",
  "Electronic Circuits",
  "Circuits Lab",
  "EM / RF",
  "Semiconductor Devices",
];

const statusConfig = [
  { key: "featured" as const, label: "★ Featured", color: "text-cyan-400" },
  { key: "completed" as const, label: "● Completed", color: "text-green-400" },
  { key: "in-progress" as const, label: "◐ In Progress", color: "text-yellow-400" },
  { key: "archived" as const, label: "○ Archived", color: "satl-muted" },
];
---

<Layout title="Projects | SATL Lab">
  <main class="mx-auto max-w-4xl px-4 py-12">
    <h1 class="text-3xl font-bold">Projects</h1>
    <p class="mt-2" style="color: var(--satl-text-dim);">
      완성된 프로젝트를 상태/카테고리별로 정리합니다.
    </p>

    <div class="mt-6 flex flex-wrap gap-2">
      {categories.map((cat) => (
        <span class="satl-chip">{cat}</span>
      ))}
    </div>

    <div class="mt-6 flex flex-wrap gap-4 text-xs font-mono">
      <span class="text-cyan-400">★ Featured</span>
      <span class="text-green-400">● Completed</span>
      <span class="text-yellow-400">◐ In Progress</span>
      <span class="satl-muted">○ Archived</span>
    </div>

    {allProjects.length === 0 ? (
      <div
        class="satl-card mt-10 p-8 text-center font-mono text-sm"
        style="color: var(--satl-text-dim);"
      >
        // no projects yet
      </div>
    ) : (
      <div class="mt-8 space-y-12">
        {statusConfig.map((section) => {
          const items = buckets[section.key];
          return (
            items.length > 0 && (
              <div>
                <h2 class={`text-lg font-semibold font-mono ${section.color}`}>
                  {section.label}
                </h2>

                <div class="mt-4 space-y-4">
                  {items.map((post) => (
                    <ContentCard
                      href={`/projects/${post.id}`}
                      title={post.data.title}
                      date={post.data.publishedAt}
                      summary={post.data.summary}
                      tags={post.data.tags}
                      badgeLeft={post.data.category}
                      badgeRight={post.data.projectStatus ?? "in-progress"}
                      badgeRightClass={section.color}
                    />
                  ))}
                </div>
              </div>
            )
          );
        })}
      </div>
    )}
  </main>
</Layout>